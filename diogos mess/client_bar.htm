<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <title>Count Occurrences of Subscription Types</title>
</head>
<body>

<script>
    // Load the data from the CSV file
    d3.csv("../data/trip.csv").then(function(data) {
        // Extract the subscription_type column
        var subscriptionTypes = data.map(function(d) {
            return d.subscription_type;
        });

        // Count occurrences of each label
        var labelCounts = {};
        subscriptionTypes.forEach(function(label) {
            labelCounts[label] = (labelCounts[label] || 0) + 1;
        });

        // Log the counts to the console
        console.log(labelCounts);

        // Set up SVG dimensions
        var margin = { top: 20, right: 20, bottom: 70, left: 70 };
        var w = 500 - margin.left - margin.right;
        var h = 300 - margin.top - margin.bottom;

        // Create an SVG element
        var svg = d3.select("body")
                    .append("svg")
                    .attr("width", w + margin.left + margin.right)
                    .attr("height", h + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // Get the maximum count
        var maxCount = Math.max(...Object.values(labelCounts));

        // Create rectangles based on the counts
        var rects = svg.selectAll("rect")
            .data(Object.entries(labelCounts))
            .enter()
            .append("rect")
            .attr("x", function (d, i) {
        return (i * (w / Object.keys(labelCounts).length));
    })  
            .attr("y", function (d) {
                return h - (h * d[1] / maxCount);
            })
            .attr("width", (w / Object.keys(labelCounts).length - 1))
            .attr("height", function (d) {
                return (h * d[1] / maxCount);
            })
            .attr("fill", function (d) {
                return "rgb(0, 100, " + Math.round((d[1] / maxCount) * 255) + ")";
            });

        // Create x and y scales
        var xScale = d3.scaleBand()
    .domain(d3.range(Object.keys(labelCounts).length))
    .range([0, w])
    .padding(0.1);

        var yScale = d3.scaleLinear()
            .domain([0, maxCount])
            .range([h, 0]);

        // Create x and y axes
        var xAxis = d3.axisBottom(xScale);
        var yAxis = d3.axisLeft(yScale);

        // Append x and y axes to the SVG
        svg.append("g")
            .attr("transform", "translate(0," + h + ")")
            .call(xAxis);

        svg.append("g")
            .call(yAxis);

        // Add title to the chart
        svg.append("text")
            .attr("x", w / 2)
            .attr("y", -margin.top / 2.3)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .text("Subscription Types Occurrences");

        // Add Y-axis title
        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", -margin.left + 10)
            .attr("x", -h / 2)
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .style("font-size", "14px")
            .text("Count");

        // Add legend
        var legend = svg.selectAll(".legend")
            .data(Object.entries(labelCounts))
            .enter().append("g")
            .attr("class", "legend")
            .attr("transform", function(d, i) {
                return "translate(0," + i * 20 + ")";
            });

        legend.append("rect")
            .attr("x", w - 18)
            .attr("width", 18)
            .attr("height", 18)
            .style("fill", function(d) {
                return "rgb(0, 100, " + Math.round((d[1] / maxCount) * 255) + ")";
            });

        legend.append("text")
            .attr("x", w - 24)
            .attr("y", 9)
            .attr("dy", ".35em")
            .style("text-anchor", "end")
            .text(function(d) {
                return d[0] ;
            });

        // Log the counts to the console
        console.log(labelCounts);
    });
</script>

</body>
</html>
